# Каталог Монет: Telegram Бот и WebApp
Этот проект представляет собой Telegram-бота с интегрированным мини-приложением (WebApp) для управления каталогом монет. Данные о монетах хранятся в Excel-файле и синхронизируются с базой данных SQLite.

## Возможности
WebApp Каталог Монет: Пользователи Telegram могут просматривать каталог монет через удобное мини-приложение прямо в Telegram.

- Синхронизация с Excel: Данные о монетах автоматически синхронизируются из Excel-файла (coins.xlsx) с базой данных SQLite при запуске бота.
- Административная команда: Администраторы могут вручную запускать синхронизацию данных из Excel с помощью команды /update_excel_data в Telegram.
- Бронирование монет: Пользователи могут "бронировать" монеты через WebApp, что уменьшает их доступное количество в базе данных.

## Настройка Проекта
Перед запуском проекта необходимо настроить несколько параметров в файле app.py.

Откройте файл app.py в любом текстовом редакторе (например, VS Code, Notepad++).

Найдите секцию --- НАСТРАИВАЕМЫЕ ПАРАМЕТРЫ ПРОЕКТА --- в верхней части файла.

Python

### --- НАСТРАИВАЕМЫЕ ПАРАМЕТРЫ ПРОЕКТА ---

### 1. ТОКЕН ТВОЕГО TELEGRAM БОТА
TOKEN = "ТВОЙ_ТОКЕН_БОТА_ЗДЕСЬ"

### 2. ИМЯ EXCEL-ФАЙЛА С ДАННЫМИ О МОНЕТАХ
EXCEL_FILE = 'coins.xlsx'

### 3. ИМЯ ФАЙЛА БАЗЫ ДАННЫХ SQLite
DATABASE_FILE = 'database.db'

### 4. АДРЕС БАЗЫ ДАННЫХ (обычно менять не нужно)
DATABASE_URL = f'sqlite:///{DATABASE_FILE}'

### 5. ID АДМИНИСТРАТОРОВ TELEGRAM
ADMIN_IDS = [ТВОЙ_АДМИН_ID_ЗДЕСЬ]

### 6. БАЗОВЫЙ URL ДЛЯ WEBAPP (для Ngrok обновляется через BotFather)
DEFAULT_WEBAPP_URL = "https://example.com/coin_catalog"

Измените следующие параметры:

TOKEN: Вставьте токен вашего Telegram-бота, который вы получили от @BotFather.
EXCEL_FILE: Если ваш Excel-файл с данными о монетах называется иначе, измените это имя. Убедитесь, что он находится в той же папке, что и app.py.
DATABASE_FILE: По желанию, вы можете изменить имя файла базы данных SQLite.
ADMIN_IDS: Введите свой ID пользователя Telegram. Вы можете узнать свой ID, отправив сообщение боту @userinfobot в Telegram. Если у вас несколько администраторов, добавьте их ID через запятую, например: ADMIN_IDS = [123456789, 987654321].

Сохраните изменения в файле app.py.

## Подготовка Excel-файла (coins.xlsx)
Откройте файл coins.xlsx.
КРАЙНЕ ВАЖНО: Убедитесь, что каждая монета в столбце "Номер" имеет уникальное значение. Если вы используете одинаковые номера для разных монет, в каталоге будет отображаться только одна из них (та, которая была последней в файле Excel).
Сохраните изменения в coins.xlsx.

## Запуск Проекта (Пошаговая Инструкция)
Для работы проекта необходимо запустить три отдельных компонента, каждый в своем собственном окне терминала (например, Windows PowerShell или Командная строка).

Перед началом: Убедитесь, что все файлы проекта (app.py, coins.xlsx, папка static, а также ngrok.exe) находятся в одной и той же папке.

### Шаг 1: Запуск Ngrok (публичный доступ к каталогу)
Откройте второе окно Windows PowerShell или Командной строки.

Перейдите в ту же папку вашего проекта, что и в Шаге 1:

cd D:\Projects\coin_catalog
Запустите Ngrok, чтобы создать публичный URL для вашего Flask-сервера:

.\ngrok http 5000
Ngrok запустится и покажет вам информацию о соединении. Найдите строку, начинающуюся с https:// (например, https://abcdef12345.ngrok-free.app). Это ваш публичный HTTPS-URL.

Скопируйте этот HTTPS-URL. Внимание: этот URL меняется при каждом новом запуске Ngrok!

Перейдите в Telegram и найдите @BotFather.

Отправьте ему команду /setwebapp.

Выберите вашего бота из списка.

BotFather попросит вас ввести URL. Вставьте туда только что скопированный HTTPS-URL от Ngrok и отправьте его. Это свяжет ваше мини-приложение с ботом.

Не закрывайте это окно Ngrok.

### Шаг 2: Запуск Telegram-бота
Откройте третье окно Windows PowerShell или Командной строки.

Перейдите в ту же папку вашего проекта, что и в Шаге 1 и 2:

cd D:\Projects\coin_catalog
Запустите скрипт бота командой:

python app.py
В этом окне вы должны увидеть следующие сообщения:

База данных SQLite создана или обновлена: database.db

Сообщения о синхронизации монет из Excel.

Синхронизация Excel с базой данных завершена успешно!

Запуск Telegram бота (polling)...

КРАЙНЕ ВАЖНО: После Запуск Telegram бота (polling)... не должно быть никаких ошибок (Cannot close a running event loop, RuntimeWarning и т.д.). Если ошибки появляются, это означает, что бот не запустился полностью.

## Проверка работы проекта
Если все 2 окна терминала работают без ошибок, откройте Telegram.
Найдите вашего бота.
Отправьте ему команду /start.
Бот должен ответить сообщением и кнопкой "Открыть Каталог Монет".
Нажмите на кнопку "Открыть Каталог Монет". Должно открыться мини-приложение с каталогом ваших монет.
Если вы видите предупреждение Ngrok, нажмите "Visit Site". Это нормально для бесплатной версии Ngrok.
Если вы видите "Example Domain" или похожую страницу-заглушку, это означает, что вы не обновили URL в BotFather
Если вы видите "Internal Server Error", это означает, что Flask-сервер не работает или Ngrok не может к нему подключиться
Попробуйте отправить команду /update_excel_data. Если бот работает и вы указали свой ID в ADMIN_IDS, он должен ответить сообщением о начале синхронизации, а затем о ее завершении.

## Остановка проекта
Чтобы остановить все компоненты проекта:

Просто закройте окна терминала
