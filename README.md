# Каталог Монет: Telegram Бот и WebApp
Этот проект представляет собой Telegram-бота с интегрированным мини-приложением (WebApp) для управления каталогом монет. Данные о монетах хранятся в Excel-файле и синхронизируются с базой данных SQLite.

## Функционал
- Удобный просмотр каталога монет с фото и важными данными (металл, цена и т.д.), возможность поиска и фильтрации данных
- Отображение желаемых монет в корзине, которую можно редактировать
- Данные о монетах автоматически синхронизируются из Excel-файла (coins.xlsx) с базой данных SQLite при запуске бота
- Администраторы могут вручную запускать синхронизацию данных из Excel с помощью команды /update в Telegram, также администраторы получают уведовление в телеграме, когда оформляется заказ монет
- Пользователи могут бронировать монеты через WebApp, что уменьшает их доступное количество в базе данных, далее осталые пользователи видят актуальное количество монет
- При бронировании пользователь вводит свое ФИО и выбирает офис, эти данные сохраняются в excel-файл и приходят сообщением администратору 

## Настраиваемые параметры

### 1. ТОКЕН TELEGRAM БОТА
TOKEN = "ТОКЕН_БОТА_ЗДЕСЬ"

### 2. ИМЯ EXCEL-ФАЙЛА С ДАННЫМИ О МОНЕТАХ
EXCEL_FILE = 'coins.xlsx'

### 3. ИМЯ ФАЙЛА БАЗЫ ДАННЫХ SQLite
DATABASE_FILE = 'database.db'

### 4. АДРЕС БАЗЫ ДАННЫХ (менять не нужно)
DATABASE_URL = f'sqlite:///{DATABASE_FILE}'

### 5. ID АДМИНИСТРАТОРОВ TELEGRAM
ADMIN_IDS = [АДМИН_ID]

### 6. БАЗОВЫЙ URL ДЛЯ WEBAPP (для Ngrok обновляется через BotFather)
DEFAULT_WEBAPP_URL = "https://example.com/coin_catalog"

## Excel-файла (coins.xlsx)
КРАЙНЕ ВАЖНО: Каждая монета в столбце "Номер" должна иметь уникальное значение. Если используются одинаковые номера для разных монет, в каталоге будет отображаться только одна из них (та, которая была последней в файле Excel)

## Запуск Проекта
Для работы проекта необходимо запустить три отдельных компонента, каждый в своем собственном окне терминала

Важно: все файлы проекта (app.py, coins.xlsx, папка static, а также ngrok.exe) находятся в одной и той же папке.

### Шаг 1: Запуск Ngrok (публичный доступ к каталогу)
Открыть второе окно Windows PowerShell или Командной строки.
Запустить Ngrok, чтобы создать публичный URL для Flask-сервера:
.\ngrok http 5000
Ngrok запустится и покажет информацию о соединении. Строка, начинающаяся с https:// (например, https://abcdef12345.ngrok-free.app) - это публичный HTTPS-URL.
Внимание: этот URL меняется при каждом новом запуске Ngrok!
Перейдите в Telegram и найдите @BotFather.
Отправьте ему команду /setwebapp.
Выберите вашего бота из списка.
BotFather попросит вас ввести URL. Вставьте туда только что скопированный HTTPS-URL от Ngrok и отправьте его. Это свяжет ваше мини-приложение с ботом.
Не закрывайте это окно Ngrok.
Заменить эту ссылку в коде, для работы бота

### Шаг 2: Запуск Telegram-бота
Откройте третье окно Windows PowerShell или Командной строки.
Запустите скрипт бота командой:
python app.py
В этом окне вы должны увидеть следующие сообщения:
База данных SQLite создана или обновлена: database.db
Сообщения о синхронизации монет из Excel.
Синхронизация Excel с базой данных завершена успешно!
Запуск Telegram бота (polling)...
КРАЙНЕ ВАЖНО: После Запуск Telegram бота (polling)... не должно быть никаких ошибок (Cannot close a running event loop, RuntimeWarning и т.д.). Если ошибки появляются, это означает, что бот не запустился полностью.

## Проверка работы проекта
Если все 2 окна терминала работают без ошибок, откройте Telegram.
Найдите вашего бота.
Отправьте ему команду /start.
Бот должен ответить сообщением и кнопкой "Открыть Каталог Монет".
Нажмите на кнопку "Открыть Каталог Монет". Должно открыться мини-приложение с каталогом ваших монет.
Если вы видите предупреждение Ngrok, нажмите "Visit Site". Это нормально для бесплатной версии Ngrok.
Если вы видите "Example Domain" или похожую страницу-заглушку, это означает, что вы не обновили URL в BotFather
Если вы видите "Internal Server Error", это означает, что Flask-сервер не работает или Ngrok не может к нему подключиться
Попробуйте отправить команду /update. Если бот работает и вы указали свой ID в ADMIN_IDS, он должен ответить сообщением о начале синхронизации, а затем о ее завершении.

## Остановка проекта
Чтобы остановить все компоненты проекта:
Просто закройте окна терминала
